!function(t){function e(e,i,s){this.element=t(e);var n=this.element.data();this.picker=t("<div class='jsunpicker' />"),this.options=t.extend({language:"en-US",daysTitle:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthsTitle:["January","February","March","April","May","June","July","August","September","October","November","December"],dayShort:2,monthShort:3,showIcon:null,inline:null,startDay:1,pickerType:"datetime",displayFormat:"W, T d, Y H:N:S A",outputFormat:"U",minDate:null,maxDate:null,minTime:null,maxTime:null,disabledDays:null,disabledDates:null,initialDate:null,onShow:t.noop,onClose:t.noop,onSelect:t.noop},s,n),this.pickerElement=this.pickerElement(),this.pickerInit=this.pickerElement.initElement,this.clone=this.pickerElement.clone,null!==this.options.initialDate&&(this.initialDate=this.options.initialDate,this.select(this.initialDate)),this.options.inline?(this.render(this.options.pickerType,this.initialDate),this.picker.css({display:"inline-block",position:"relative","z-index":"100"}),t(this.options.inline).append(this.picker)):(this.element.after(this.picker),this.picker.css(this.pickerPosition(this.pickerInit))),this.pickerInit.click(t.proxy(function(){null==this.options.inline?this.picker.toggle():"",this.render(this.options.pickerType,this.element.attr("data-selected-value"))},this)),this.clone.change(t.proxy(function(){selectedValue=this.formatDate(this.clone.val(),"Y/M/D H:N:S"),this.select(selectedValue),this.render(this.options.pickerType,selectedValue)},this)),this.picker.on("click",".prevButton, .titleButton, .nextButton, .year, .month",t.proxy(function(e){var i=t(e.currentTarget);i.data("view")&&i.data("nav")?this.render(i.data("view"),i.data("nav")):""},this)),this.picker.on("click",".day, .otherday, .fav",t.proxy(function(e){var i=t(e.currentTarget);if(!i.hasClass("disabled")){i.addClass("selected").siblings().removeClass("selected");var s=i.data("nav");this.select(s),"datetime"==this.options.pickerType?this.render("time",s):null==this.options.inline?this.picker.hide():this.render(this.options.pickerType,s)}},this)),this.picker.on("change",".time",t.proxy(function(e){var i=t(e.currentTarget),s=i.find(".error"),n=i.find(".timeButton"),a=i.find(".hour").val()+":"+i.find(".min").val()+":"+i.find(".sec").val()+" "+(i.find(".ampm").is(":checked")?"PM":"AM");this.minMax(n.data("date")+a,n.data("date")+this.options.minTime,n.data("date")+this.options.maxTime)?s.html("Invalid Time"):s.html(""),n.data("nav",n.data("date")+a).val(a).text(a)},this)),this.picker.on("click",".timeButton",t.proxy(function(e){var i=t(e.currentTarget);e.preventDefault();var s=this.minMax(i.data("nav"),i.data("date")+this.options.minTime,i.data("date")+this.options.maxTime);-1==["datetime","time"].indexOf(this.options.pickerType)||s||(this.element.val(this.formatDate(i.data("nav"),this.options.outputFormat)),this.clone.val(this.formatDate(i.data("nav"),this.options.displayFormat)),null==this.options.inline?this.picker.hide():"datetime"==this.options.pickerType?this.render("date",i.data("nav")):"")},this))}t.fn.jSunPicker=function(t){return this.each(function(i){new e(this,i,t)})},e.prototype={dateComponents:function(t){var e=t&&Date.parse(t.replace(/-/g,"/"))?new Date(Date.parse(t.replace(/-/g,"/"))):new Date,i={year:e.getFullYear(),month:e.getMonth(),date:e.getDate(),day:e.getDay(),hours:e.getHours(),minutes:e.getMinutes(),seconds:e.getSeconds()};return i},dateRange:function(t){var e=[],s=t.split(",");for(i=0;i<s.length;i++)if(s[i].search("-")>=0)for(var n=s[i].split("-"),a=new Date(n[0]),r=new Date(n[1]);r>a;)e.push(a.valueOf()),a=new Date(a.setDate(a.getDate()+1));else e.push(new Date(s[i]).valueOf());return e},minMax:function(t,e,i){var s=!1;return t&&null!==e&&(s=new Date(t)-new Date(e)<0?!0:!1),t&&null!==i&&!s&&(s=new Date(t)-new Date(i)>0?!0:!1),s},select:function(e){this.element.attr("data-selected-Value",e).val(this.formatDate(e,this.options.outputFormat)),this.clone.val(this.formatDate(e,this.options.displayFormat)),t.isFunction(this.options.onSelect)&&this.options.onSelect(e)},destroy:function(){this.picker&&(this.picker.remove(),this.picker=null,t.isFunction(this.options.onClose)&&this.options.onClose())},render:function(e,i){this.picker.html(this.renderCalendar(e,i)),t.isFunction(this.options.onShow)&&this.options.onShow()},pickerElement:function(){return this.clone=this.element.clone().removeAttr("name").attr("autocomplete","off").attr("id",this.element.attr("id")+"_clone"),this.element.after(this.clone),null!=this.options.showIcon?this.clone.after(this.initElement=t("<span class='calendarButton'><img src='"+this.options.showIcon+"' /></span>")):this.initElement=this.clone,this.element.hide(),pickerElement={initElement:this.initElement,clone:this.clone,original:this.element}},pickerPosition:function(){var e=this.clone,i={left:e.offset().left,top:e.offset().top},s=t(window).height(),n=t(window).scrollTop(),a=this.picker.outerHeight(),r=Math.abs(s-i.top+e.outerHeight()),o=i.top+n,h=r>a,l=o>a;return l||h?h?i.top+=e.outerHeight():i.top-=a+2:(i.top=s/2-a/2,a>s+n&&console.warn("Not enough room to display date picker.")),i},leadZero:function(t){return 10>t?"0"+t:t},formatDate:function(t,e){var i=this.dateComponents(t),s={d:i.date,D:this.leadZero(i.date),m:i.month+1,M:this.leadZero(i.month+1),t:this.options.monthsTitle[i.month].substring(0,this.options.monthShort),O:this.options.monthsTitle[i.month],y:i.year.toString().substring(2,2),Y:i.year,w:this.options.daysTitle[i.day].substring(0,this.options.dayShort),W:this.options.daysTitle[i.day],h:e.match(/a/gi)?i.hours%12?i.hours%12:12:i.hours,H:e.match(/a/gi)?this.leadZero(i.hours%12?i.hours%12:12):this.leadZero(i.hours),n:i.minutes,N:this.leadZero(i.minutes),s:i.seconds,S:this.leadZero(i.seconds),a:i.hours>11?"pm":"am",A:i.hours>11?"PM":"AM"},n=new RegExp(Object.keys(s).join("|"),"g");switch(e){case"U":formattedDate=Date.UTC(i.year,i.month,i.date,i.hours,i.minutes,i.seconds);break;case"X":formattedDate="HN".replace(n,function(t){return s[t]});break;default:formattedDate=e.replace(n,function(t){return s[t]})}return formattedDate},renderTitle:function(t,e){var i="";"datetime"!=this.options.pickerType?e=this.options.pickerType:i=this.selectedDate||this.currentYear+"/01/01";var s="<div class='title titleButton' data-nav = '"+i+"' data-view = '"+e+"'> "+t+" </div><div class='fav favButton' data-nav = '"+this.defaultValue+"' data-view = '"+e+"'> &hearts; </div>";return s},renderPrevious:function(t,e){var i="<div class='title prevButton' data-nav = '"+t+"' data-view = '"+e+"'>&lt;</div>";return i},renderNext:function(t,e){var i="<div class='title nextButton' data-nav = '"+t+"' data-view = '"+e+"'>&gt;</div>";return i},renderMonth:function(){var e=new Date(this.currentYear,this.currentMonth,1),s=new Date(this.currentYear,this.currentMonth+1,0),n=new Date(this.currentYear,this.currentMonth,0).getDate(),a=e.getDay(),r=(s.getDay(),this.options.monthsTitle[this.currentMonth]+" "+this.currentYear);switch(null!==this.options.disabledDates?disabledDates=this.dateRange(this.options.disabledDates):disabledDates=[],null!==this.options.disabledDays?disabledDays=this.options.disabledDays.split(","):disabledDays=[],this.currentMonth){case 0:prevVal=this.currentYear-1+"/12/1",nextVal=this.currentYear+"/"+(this.currentMonth+2)+"/1";break;case 11:prevVal=this.currentYear+"/"+this.currentMonth+"/1",nextVal=this.currentYear+1+"/1/1";break;default:prevVal=this.currentYear+"/"+this.currentMonth+"/1",nextVal=this.currentYear+"/"+(this.currentMonth+2)+"/1"}var o=this.renderPrevious(prevVal,this.currentView)+this.renderTitle(r,"month")+this.renderNext(nextVal,this.currentView);for(i=this.options.startDay-1;i<this.options.startDay+6;i++)o+="<div class='title'>"+this.options.daysTitle[i%7].substring(0,this.options.dayShort)+"</div>";if(a-(this.options.startDay-1)!==0)for(k=(a-this.options.startDay+7)%7;k>=0;k--){var h=n-k,l=Math.abs((k-a)%7);u=this.currentMonth?this.currentYear+"/"+this.currentMonth+"/"+h:this.currentYear-1+"/12/"+h,c=this.minMax(u,this.options.minDate,this.options.maxDate)?"disabled":t.inArray(new Date(u).valueOf(),disabledDates)>-1||t.inArray(l+"",disabledDays)>-1?"disabled":"",o+="<div class='otherday day"+l+" "+c+"' data-nav = '"+u+"'>"+h+"</div>"}for(j=1;j<=s.getDate();j++){var d="",l=Math.abs((j+a)%7)||"7";u=this.currentYear+"/"+(this.currentMonth+1)+"/"+j;var c=this.minMax(u,this.options.minDate,this.options.maxDate)?"disabled":t.inArray(new Date(u).valueOf(),disabledDates)>-1||t.inArray(l+"",disabledDays)>-1?"disabled":"";d=j==this.currentDate?"selected":"",o+="<div class='day day"+l+" "+d+" "+c+"' data-nav = '"+u+"'>"+j+"</div>"}for(m=1;m<=42-s.getDate()-(a-this.options.startDay+1+7)%7;m++){var l=Math.abs((m-a+7)%7)||"7",u="11"==this.currentMonth?this.currentYear+1+"/1/"+m:this.currentYear+"/"+(this.currentMonth+2)+"/"+m,c=this.minMax(u,this.options.minDate,this.options.maxDate)?"disabled":t.inArray(new Date(u).valueOf(),disabledDates)>=0||t.inArray(l+"",disabledDays)>-1?"disabled":"";o+="<div class='otherday day"+l+" "+c+"' data-nav = '"+u+"'>"+m+"</div>"}this.currentDate+" "+this.options.monthsTitle[this.currentMonth].substring(0,this.options.monthShort)+" "+this.currentYear;return o},renderYear:function(){var t=this.currentYear-1+"/01/01",e=this.currentYear+1+"/01/01",s=this.renderPrevious(t,this.currentView)+this.renderTitle(this.currentYear,"year")+this.renderNext(e,this.currentView);for(i=0;i<12;i++){var n=this.currentYear+"/"+(i+1)+"/1";i==this.currentMonth?selectedClass="selected":selectedClass="",s+="<div class='month "+selectedClass+"' data-view = 'date' data-nav = '"+n+"'>"+this.options.monthsTitle[i].substring(0,this.options.monthShort)+"</div>"}return s},renderDecade:function(){var t=this.currentYear-this.currentYear%20,e=t-20+"/01/01",s=t+20+"/01/01",n=t+" - "+(t+19),a=this.renderPrevious(e,this.currentView)+this.renderTitle(n,"decade")+this.renderNext(s,this.currentView);for(i=0;i<20;i++){var r=t+i+"/1/1";t+i==this.currentYear?selectedClass="selected":selectedClass="",a+="<div class='year "+selectedClass+"' data-view = 'month' data-nav = '"+r+"'>"+(t+i)+"</div>"}return a},renderTime:function(){var t=this.options.monthsTitle[this.currentMonth]+" "+this.currentDate+", "+this.currentYear,e=this.renderPrevious("",this.currentView)+this.renderTitle(t,"date")+this.renderNext("",this.currentView),i="",s=new Date,n=new Date(this.selectedDate||s),a=s.getHours()>12?(s.getHours()-12<10?"0":"")+(s.getHours()-12):(s.getHours()<10&&s.getHours()>0?"0":"")+(s.getHours()||12),r=(s.getMinutes()<10?"0":"")+s.getMinutes(),o=(s.getSeconds()<10?"0":"")+s.getSeconds(),h=s.getHours()<12?"AM ":"PM",l=n.getFullYear()+"/"+(n.getMonth()+1)+"/"+n.getDate()+" ",d=a+":"+r+":"+o+" "+h;s.getHours()>12?i="checked":"";var c=this.minMax(l+d,l+this.options.minTime,l+this.options.maxTime)?"Invalid Time":"";return e+="<div class='time'><span class='error'>"+c+"</span><div><input type='number' min='1' max='12' step='1' class='hour' value='"+a+"' /><label>:</label><input type='number' min='0' max='59'  step='1' class='min' value='"+r+"' /><label>:</label><input type='number' min='0' max='59' step='1' class='sec' value='"+o+"' /></div><p><input type='checkbox' class='ampm' value='pm' "+i+">PM</input></p>",e+="<p><button class='timeButton' data-view = 'time' data-date = '"+l+" ' data-nav = '"+l+d+"'>"+d+"</button></p></div>"},renderCalendar:function(e,i){this.selectedDate=i;var s=this.dateComponents(i);this.options.disabledDays?disabledDays=this.options.disabledDays.split(","):disabledDays=[],this.defaultDate=new Date,this.defaultValue=this.defaultDate.getFullYear()+"/"+(this.defaultDate.getMonth()+1)+"/"+this.defaultDate.getDate(),this.currentDate=s.date,this.currentView=e,this.currentYear=s.year,this.currentMonth=s.month;var n=t.proxy(function(){switch(this.currentView){default:case"datetime":return this.renderMonth();case"date":return this.renderMonth();case"month":return this.renderYear();case"year":return this.renderDecade();case"time":return this.renderTime()}},this);return n}}}(jQuery);
